"use strict";define(function(require,exports,module){var $=require("jquery");require("lib/bootstrap.min")($),require("js/bootstrapValidator.sea")($),require("js/LoadMask")($);var common=require("js/common"),Navagator=require("js/Navagator"),NavMenu=require("js/NavMenu"),Bottom=require("js/Bottom"),Toolbar=require("js/Toolbar"),Alert=require("js/Alert");require("lib/chinamapPath")(window);var Pay=React.createClass({displayName:"Pay",showAlert:function(){$(this.refs.myModal).modal()},addFav:function(e){var me=this,target=e.target;$.ajax({type:"POST",url:common.createUrl($(".htmlbody").attr("data-ajax-addfav")),data:{product_id:$(target).attr("data-pid")},beforeSend:function(){$(".submit").loadingOverlay()},success:function(data){$(".submit").loadingOverlay("remove"),data.success?me.state.city=data.data:(me.setState({title:"错误",message:data.msg}),me.showAlert())},error:function(XMLHttpRequest,textStatus){$(".submit").loadingOverlay("remove"),me.setState({title:textStatus,message:JSON.stringify(XMLHttpRequest)}),me.showAlert()},dataType:"json"})},checkchange:function(){$(this.refs.checkpro).prop("checked")?$(".btn-submit").prop("disabled",!1):$(".btn-submit").prop("disabled","disabled")},componentDidMount:function(){var me=this;$(".payForm").bootstrapValidator({message:common.regex.fail_text,feedbackIcons:{valid:common.feedbackIcons.valid,invalid:common.feedbackIcons.invalid,validating:common.feedbackIcons.validating}});var form=$(".payForm").data("bootstrapValidator");$(".btn-submit").click(function(){if(form.isValid()){var arr=form.$form.serializeArray(),pid=[];$.each(me.state.items,function(index,item){pid.push(item.product_id)}),arr.push({name:"product_id",value:pid.join(",")}),$.ajax({type:"POST",url:common.createUrl($(".htmlbody").attr("data-ajax-submit")),data:arr,beforeSend:function(){$(".submit").loadingOverlay()},success:function(data){$(".submit").loadingOverlay("remove"),data.success?window.location.href="/":(me.setState({title:"错误",message:data.msg}),me.showAlert())},error:function(XMLHttpRequest,textStatus){$(".submit").loadingOverlay("remove"),me.setState({title:textStatus,message:JSON.stringify(XMLHttpRequest)}),me.showAlert()},dataType:"json"})}else document.documentElement.scrollTop=document.body.scrollTop=0})},getInitialState:function(){var dataCity=JSON.parse($(".htmlbody").attr("data-city")),dataOrderItem=JSON.parse($(".htmlbody").attr("data-order-item"));return{title:"消息",message:"...",city:dataCity.data,items:dataOrderItem}},render:function(){var dataBreadcrumb=JSON.parse($(".htmlbody").attr("data-breadcrumb")),breadcrumbDom=[];return $.each(dataBreadcrumb,function(index,item){var cls="";return index==dataBreadcrumb.length-1?(breadcrumbDom.push(React.createElement("li",{className:"leaf"},item.name)),!1):void breadcrumbDom.push(React.createElement("li",null,React.createElement("a",{href:item.link,className:cls},item.name)))}),React.createElement("div",null,React.createElement(Navagator,null),React.createElement(NavMenu,{"data-index":"4"}),React.createElement("div",{className:"container pay"},React.createElement("img",{src:"images/A41.jpg",alt:"",className:"banner"}),React.createElement("ol",{className:"breadcrumb"},breadcrumbDom),React.createElement("form",{className:"payForm form-horizontal"})),React.createElement(Bottom,null),React.createElement(Toolbar,null),React.createElement("div",{className:"modal fade",ref:"myModal",tabIndex:"-1",role:"dialog"},React.createElement(Alert,{title:this.state.title,message:this.state.message})))}});$(function(){ReactDOM.render(React.createElement(Pay,null),$(".htmlbody").get(0))})});